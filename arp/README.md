# Address Resolution Protocol

ARP (англ. Address Resolution Protocol — протокол определения адреса)
— протокол в компьютерных сетях, предназначенный для определения
MAC-адреса другого компьютера по известному IP-адресу.

# Пайплайн

## Структуры

### Ethernet II

1. MAC-адрес получателя (6 байт)
2. MAC-адрес отправителя (6 байт)
3. Тип запроса (2 байт, у ARP равен `0x0806`)

```c
typedef struct {
  u8  dst[MAC_LEN];
  u8  src[MAC_LEN];
  u16 type;
} eth_header;
```

### ARP

1. Тип физического адреса (2 байта)
2. Код сетевого протокола (2 байта)
3. Размер физического адреса (1 байт)
4. Размер логического адреса (1 байт)
5. Код операции отправителя (1 байт)
6. Физический адрес отправителя.
7. Логический адрес отправителя.
8. Физический адрес получателя. Не требуется при запросе.
9. Логический адрес получателя.

```c
typedef struct {
  u16 hw_type;
  u16 proto_type;
  u8  hw_size;
  u8  proto_size;
  u16 opcode;
  u8  sender_mac[MAC_LEN];
  u8  sender_ip[IP_LEN];
  u8  target_mac[MAC_LEN];
  u8  target_ip[IP_LEN];
} arp_header;
```

## Порядок действий

1. Сперва заполняются поля, которые известны заранее
2. После открывается сокет для запроса и получения
3. Получаются данные интерфейса (индекс, MAC-адрес и IP-адрес), по
   известному названию
4. Собирается кадр для отправки
5. Все выводится на экран
6. Запрос отправляется через сокет
7. В бесконечном цикле принимаются все пакеты
   1. Сравнивается 13 и 14 байт ответа, отвечающий за тип запроса
   2. Если равен `0x0806`, то выводится MAC-адрес отправителя на экран
      и цикл завершается

# Источники

- Data link, ARP, игра в 16 тактов (Сеть Си): https://youtu.be/OnJVEOP7Pbs?si=QqWmgXyaXzgpyHJ4
- [Структура пакера ARP](https://ru.wikipedia.org/wiki/ARP#%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0_ARP)
- Различные мануалы
